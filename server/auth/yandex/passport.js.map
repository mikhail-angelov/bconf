{"version":3,"sources":["auth/yandex/passport.js"],"names":[],"mappings":";;;;;;;;;;AAGA,QAAQ,KAAR,GAAgB,UAAS,IAAT,EAAe,MAAf,EAAuB;AACrC,qBAAS,GAAT,CAAa,6BAAmB;AAC9B,cAAU,OAAO,MAAP,CAAc,QAAd;AACV,kBAAc,OAAO,MAAP,CAAc,YAAd;AACd,iBAAa,OAAO,MAAP,CAAc,WAAd;GAHF,EAKb,UAAS,WAAT,EAAsB,YAAtB,EAAoC,OAApC,EAA6C,IAA7C,EAAmD;AACjD,SAAK,YAAL,CAAkB;AAChB,mBAAa,QAAQ,EAAR;KADf,EAGG,IAHH,CAGQ,UAAS,IAAT,EAAe;AACnB,UAAI,CAAC,IAAD,EAAO;AACT,eAAO,IAAI,IAAJ,CAAS;AACd,gBAAM,QAAQ,WAAR;AACN,iBAAO,QAAQ,MAAR,CAAe,CAAf,EAAkB,KAAlB;AACP,gBAAM,MAAN;AACA,oBAAU,QAAQ,MAAR,CAAe,CAAf,EAAkB,KAAlB,CAAwB,KAAxB,CAA8B,GAA9B,EAAmC,CAAnC,CAAV;AACA,oBAAU,QAAV;AACA,kBAAQ,QAAQ,KAAR;SANH,CAAP,CADS;AAST,aAAK,SAAL,GACG,IADH,CACQ,UAAS,IAAT,EAAe;AACnB,iBAAO,KAAK,IAAL,EAAW,IAAX,CAAP,CADmB;SAAf,CADR,CAIG,KAJH,CAIS,UAAS,GAAT,EAAc;AACnB,iBAAO,KAAK,GAAL,CAAP,CADmB;SAAd,CAJT,CATS;OAAX,MAgBO;AACL,eAAO,KAAK,IAAL,EAAW,IAAX,CAAP,CADK;OAhBP;KADI,CAHR,CAwBG,KAxBH,CAwBS,UAAS,GAAT,EAAc;AACnB,aAAO,KAAK,GAAL,CAAP,CADmB;KAAd,CAxBT,CADiD;GAAnD,CALA,EADqC;CAAvB","file":"auth/yandex/passport.js","sourcesContent":["import passport from 'passport';\nimport {Strategy as YandexStrategy} from 'passport-yandex';\n\nexports.setup = function(User, config) {\n  passport.use(new YandexStrategy({\n    clientID: config.yandex.clientID,\n    clientSecret: config.yandex.clientSecret,\n    callbackURL: config.yandex.callbackURL\n  },\n  function(accessToken, refreshToken, profile, done) {\n    User.findOneAsync({\n      'yandex.id': profile.id\n    })\n      .then(function(user) {\n        if (!user) {\n          user = new User({\n            name: profile.displayName,\n            email: profile.emails[0].value,\n            role: 'user',\n            username: profile.emails[0].value.split('@')[0],\n            provider: 'yandex',\n            yandex: profile._json\n          });\n          user.saveAsync()\n            .then(function(user) {\n              return done(null, user);\n            })\n            .catch(function(err) {\n              return done(err);\n            });\n        } else {\n          return done(null, user);\n        }\n      })\n      .catch(function(err) {\n        return done(err);\n      });\n  }));\n};\n"],"sourceRoot":"/source/"}