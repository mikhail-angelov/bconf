{"version":3,"sources":["api/user/user.model.spec.js"],"names":[],"mappings":"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","file":"api/user/user.model.spec.js","sourcesContent":["'use strict';\n\n//import app from '../..';\nimport { User}  from './user.model';\nvar user;\nvar otherUser;\nvar genUser = function () {\n    user = new User({\n        provider: 'local',\n        name: 'Fake User',\n        email: 'test@example.com',\n        password: 'password'\n    });\n\n    return user;\n};\nvar genOtherUser = function () {\n    otherUser = new User({\n        provider: 'local',\n        name: 'Other User',\n        email: 'other@example.com',\n        password: 'password'\n    });\n\n    return otherUser;\n};\n\ndescribe('User Model', function () {\n    before(function () {\n        // Clear users before testing\n        return User.remove();\n    });\n\n    beforeEach(function () {\n        genUser();\n    });\n\n    afterEach(function () {\n        return User.remove();\n    });\n\n    it('should begin with no users', function () {\n        return User.find({}).should\n            .eventually.have.length(0);\n    });\n\n    it('should fail when saving a duplicate user', function () {\n        return user.save()\n            .then(function () {\n                var userDup = genUser();\n                return userDup.save();\n            }).should.be.rejected;\n    });\n\n    describe('#email', function () {\n        it('should fail when saving without an email', function () {\n            user.email = '';\n            return user.save().should.be.rejected;\n        });\n    });\n\n    describe('#password', function () {\n        beforeEach(function () {\n            return user.save();\n        });\n\n        it('should authenticate user if valid', function () {\n            user.authenticate('password').should.be.true;\n        });\n\n        it('should not authenticate user if invalid', function () {\n            user.authenticate('blah').should.not.be.true;\n        });\n\n        it('should remain the same hash unless the password is updated', function () {\n            user.name = 'Test User';\n            return user.save()\n                .then(function (u) {\n                    return u.authenticate('password');\n                }).should.eventually.be.true;\n        });\n    });\n\n    describe('contacts', function () {\n        beforeEach(function () {\n            genOtherUser();\n            return user.save().then(()=> {\n                return otherUser.save();\n            });\n        });\n\n        it('should add contact', function () {\n            return User.addContact(user.id, otherUser.id)\n                .then(function (u) {\n                    return User.getContacts(user.id);\n                })\n                .then(function (contacts) {\n                    var contact = contacts[0];\n                    contact.name.should.be.equal('Other User');\n                    expect(contact.password).to.be(undefined);\n                    return contacts.length === 1;\n                })\n                .should.eventually.be.true;\n        });\n\n        it('should remove contact', function () {\n            return User.addContact(user.id, otherUser.id, 'test')\n                .then(function (u) {\n                    return User.getContacts(user.id);\n                })\n                .then(function (contacts) {\n                    expect(contacts.length).to.be(1);\n                    return contacts;\n                })\n                .then(function () {\n                    return User.removeContact(user.id, otherUser.id);\n                })\n                .then(function (u) {\n                    return User.getContacts(user.id);\n                })\n                .then(function (contacts) {\n                    expect(contacts.length).to.be(0);\n                    return contacts.length == 0;\n                })\n                .should.eventually.be.true;\n        });\n\n        it('should accept contact', function () {\n            return User.addContact(user.id, otherUser.id, 'test')\n                .then(function (u) {\n                    return User.getContacts(user.id);\n                })\n                .then(function (contacts) {\n                    expect(contacts.length).to.be(1);\n                    expect(contacts[0].status).to.be('pending');\n                    expect(contacts[0].id).to.be(otherUser.id);\n                    return contacts;\n                })\n                .then(function () {\n                    return User.acceptContact(otherUser.id, user.id);\n                })\n                .then(function (u) {\n                    console.log('t1  ', u)\n                    return User.getContacts(user.id);\n                })\n                .then(function (contacts) {\n                    console.log('t2 ', contacts, user.id)\n                    expect(contacts.length).to.be(1);\n                    expect(contacts[0].status).to.be('buddy');\n                    return contacts.length == 1;\n                })\n                .should.eventually.be.true;\n        });\n\n\n    });\n\n});\n"],"sourceRoot":"/source/"}