{"version":3,"sources":["api/chat/chat.model.spec.js"],"names":[],"mappings":"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","file":"api/chat/chat.model.spec.js","sourcesContent":["'use strict';\n\nimport { Chat}  from './chat.model';\nimport { User}  from '../user/user.model';\nimport testDb from '../../test/testDb.js';\nimport _ from 'lodash';\n\n\ndescribe('Chat Model', function () {\n    before(function () {\n        return Chat.removeAsync();\n    });\n\n    beforeEach(function () {\n        return testDb.init().then((db)=> {\n            expect(!!testDb.user._id).to.be(true);\n        })\n    });\n\n    afterEach(function () {\n        Chat.removeAsync()\n        return testDb.reset()\n    });\n\n    it('should begin with users', function () {\n        var user = testDb.user;\n        return User.findAsync({_id: user._id}).should\n            .eventually.have.length(1);\n    });\n\n    it('should create chat', function (done) {\n        var chat = {\n            name: 'test',\n            list: [testDb.user._id, testDb.otherUser._id]\n        };\n        return Chat.create(chat)\n            .then(()=> {\n                return Chat.getUserChats(testDb.user._id);\n            })\n            .then(chatRecords=> {\n                let chatRecord = [];\n                _.forIn(chatRecords, (value, key)=> {\n                    chatRecord.push(value);\n                })\n                expect(chatRecord[0].name).to.be('test');\n                expect(!!chatRecord[0].chatId).to.be(true);\n                expect(chatRecord[0].list.length).to.be(2);\n                expect(chatRecord[0].list[0]).to.be(testDb.user._id.toString());\n\n                done()\n            });\n    });\n\n    it('should add/remove chat user', function (done) {\n        var chat = {\n            name: 'test',\n            list: [testDb.user._id]\n        };\n        var chatId;\n        return Chat.create(chat)\n            .then(()=> {\n                return Chat.getUserChats(testDb.user._id);\n            })\n            .then(chatRecords=> {\n                let chatRecord = [];\n                _.forIn(chatRecords, (value, key)=> {\n                    chatRecord.push(value);\n                });\n                chatId = chatRecord[0].chatId;\n                expect(chatRecord[0].list.length).to.be(1);\n            })\n            .then(()=> {\n                return Chat.addChatUser(chatId, testDb.otherUser._id);\n            })\n            .then(()=>{\n                return Chat.getUserChats(testDb.otherUser._id);\n            })\n            .then(chatRecords=> {\n                let chatRecord = [];\n                _.forIn(chatRecords, (value, key)=> {\n                    chatRecord.push(value);\n                });\n                expect(chatRecord[0].list.length).to.be(2);\n            })\n            .then(()=> {\n                return Chat.removeChatUser(chatId, testDb.user._id);\n            })\n            .then(()=>{\n                return Chat.getUserChats(testDb.otherUser._id);\n            })\n            .then(chatRecords=> {\n                let chatRecord = [];\n                _.forIn(chatRecords, (value, key)=> {\n                    chatRecord.push(value);\n                });\n                expect(chatRecord[0].list.length).to.be(1);\n\n                done();\n            })\n    });\n\n\n});\n"],"sourceRoot":"/source/"}