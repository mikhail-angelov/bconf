{"version":3,"sources":["api/contact/contact.controller.js"],"names":[],"mappings":"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","file":"api/contact/contact.controller.js","sourcesContent":["'use strict';\n\nimport User from '../user/user.model';\nimport _ from 'lodash';\n\n\nfunction validationError(res, statusCode) {\n    statusCode = statusCode || 422;\n    return function (err) {\n        res.status(statusCode).json(err);\n    }\n}\n\nfunction getCurrentUser(userId) {\n    return User.findOneAsync({_id: userId}, '-salt -hashedPassword');\n}\n\nlet getContacts = function (req, res) {\n\n    console.log('req.user', req.user)\n    var userId = req.user._id;\n    var role = req.user.role;\n    if (role === 'guest') {\n        //todo refactor it\n        let application = require('../../index.js');\n        let robotMaster = application.di.robotMaster;\n        let list = robotMaster.getAll();\n        res.json(list);\n    } else {\n        User.getContacts(userId)\n            .then(function (contacts) {\n                res.json(contacts);\n            });\n    }\n};\nexports.index = getContacts;\n\n\nexports.add = function (req, res, next) {\n    let userId = req.user._id;\n    let contactId = req.body.contactId;\n    let invitation = req.body.invitation;\n    User.addContact(userId, contactId,invitation)\n        .then( ()=> getContacts(req, res))\n        .catch(validationError(res));\n};\n\nexports.accept = function (req, res, next) {\n    let userId = req.user._id;\n    let contactId = req.body;\n    User.acceptContact(userId, contactId)\n        .then( ()=> res.status(200).end())\n        .catch(validationError(res));\n};\n\nexports.update = function (req, res, next) {\n    var userId = req.params.id;\n\n    //todo: not implemented\n    res.status(204).end();\n};\n\nexports.destroy = function (req, res) {\n    var userId = req.user._id;\n    var contactId = req.body;\n    User.removeContact(userId, contactId)\n        .then(function () {\n            res.status(201).end();\n        })\n        .catch(validationError(res));\n};\n\n\nexports.createGuest = function (req, res, next) {\n    var newUser = new User(req.body);\n    var userId = req.user._id;\n    newUser.provider = 'local';\n    newUser.role = 'guest';\n    newUser.owner = userId;\n    newUser.saveAsync()\n        .spread(function (user) {\n            res.json(user);\n        })\n        .catch(validationError(res));\n};\n\nexports.search = function (req, res) {\n    var userId = req.user._id;\n    var text = req.query.text;\n    User.findAsync({name:{ \"$regex\": text, \"$options\": \"i\" } })\n        .then(function (contacts) {\n            let restricted = _.map(contacts,'contactInfo')\n            res.json(restricted);\n        })\n        .catch(validationError(res));\n};"],"sourceRoot":"/source/"}